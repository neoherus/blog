<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="shortcut icon" type="image/x-icon" href="" media="screen"><title>读取PC串口设备名称和串口号 - vimcaw的个人博客</title><link rel="stylesheet" href="/blog/css/post-77c9a42a46226eb8c00d8d54b55b87e8.css"><link rel="shortcut icon" href="/blog/image/favicon-d75f01b3d24560fb09e136bdc6e2d396.ico" type="image/vnd.microsoft.icon"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?46649aaca124d5d1bfd6d10d28ddb51d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115055193-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-115055193-1")</script></head><body><header id="top"><div class="top-inner"><div class="icon"><a href="/blog/"><img src="/blog/image/icon-0fd3804fbdfc60e0756c074adef5769e.png" alt="">vimcaw的个人博客</a></div><div class="site-nav"><a href="/blog/">首页</a><ul class="site-category-list"><li class="site-category-list-item"><a class="site-category-list-link" href="/blog/categories/C/">C#</a></li><li class="site-category-list-item"><a class="site-category-list-link" href="/blog/categories/Hexo/">Hexo</a></li><li class="site-category-list-item"><a class="site-category-list-link" href="/blog/categories/Web前端/">Web前端</a></li><li class="site-category-list-item"><a class="site-category-list-link" href="/blog/categories/个人项目/">个人项目</a></li><li class="site-category-list-item"><a class="site-category-list-link" href="/blog/categories/软件/">软件</a></li></ul></div></div></header><div class="content"><div class="sidebar"><div class="loader">Loading...</div></div><div class="main"><header>读取PC串口设备名称和串口号</header><div class="info"><div class="category"><ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/blog/categories/C/">C#</a></li></ul></div><ul><li><span class="iconfont icon-publish">发表于 </span><span class="date" title="2017-11-09 15:16:03">2017-11-09</span></li><li><span class="iconfont icon-update">最后更新于 </span><span class="date" title="2018-03-05 19:08:50">2018-03-05</span></li><li class="tag"><span class="iconfont icon-tags">标签:</span><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/WMI/">WMI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/串口/">串口</a></li></ul></li><li id="/blog/2017/11/09/读取PC串口设备名称和串口号/" class="leancloud_visitors" data-flag-title="读取PC串口设备名称和串口号">阅读次数</li></ul></div><article><p>在C#中，一般而言，读取串口号用<code>SerialPort.GetPortNames()</code>即可，但是这样读取的串口号形式为“COM3”没有设备名称（比如“Arduino UNO”，本文介绍如何通过WMI查询读取设备名称。<br><a id="more"></a></p><h1 id="Win32-SerialPort-API"><a href="#Win32-SerialPort-API" class="headerlink" title="Win32 SerialPort API"></a>Win32 SerialPort API</h1><p>首先定义枚举，枚举出Win32 API，其中<code>Win32_SerialPort</code>就是串口API<br></p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span><br><span class="hljs-comment"><span class="hljs-doctag">///</span> 枚举win32 api</span><br><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> HardwareEnum<br>&#123;<br>    <span class="hljs-comment">// 硬件</span><br>    Win32_Processor, <span class="hljs-comment">// CPU 处理器</span><br>    Win32_PhysicalMemory, <span class="hljs-comment">// 物理内存条</span><br>    Win32_Keyboard, <span class="hljs-comment">// 键盘</span><br>    Win32_PointingDevice, <span class="hljs-comment">// 点输入设备，包括鼠标。</span><br>    Win32_FloppyDrive, <span class="hljs-comment">// 软盘驱动器</span><br>    Win32_DiskDrive, <span class="hljs-comment">// 硬盘驱动器</span><br>    Win32_CDROMDrive, <span class="hljs-comment">// 光盘驱动器</span><br>    Win32_BaseBoard, <span class="hljs-comment">// 主板</span><br>    Win32_BIOS, <span class="hljs-comment">// BIOS 芯片</span><br>    Win32_ParallelPort, <span class="hljs-comment">// 并口</span><br>    Win32_SerialPort, <span class="hljs-comment">// 串口</span><br>    Win32_SerialPortConfiguration, <span class="hljs-comment">// 串口配置</span><br>    Win32_SoundDevice, <span class="hljs-comment">// 多媒体设置，一般指声卡。</span><br>    Win32_SystemSlot, <span class="hljs-comment">// 主板插槽 (ISA &amp; PCI &amp; AGP)</span><br>    Win32_USBController, <span class="hljs-comment">// USB 控制器</span><br>    Win32_NetworkAdapter, <span class="hljs-comment">// 网络适配器</span><br>    Win32_NetworkAdapterConfiguration, <span class="hljs-comment">// 网络适配器设置</span><br>    Win32_Printer, <span class="hljs-comment">// 打印机</span><br>    Win32_PrinterConfiguration, <span class="hljs-comment">// 打印机设置</span><br>    Win32_PrintJob, <span class="hljs-comment">// 打印机任务</span><br>    Win32_TCPIPPrinterPort, <span class="hljs-comment">// 打印机端口</span><br>    Win32_POTSModem, <span class="hljs-comment">// MODEM</span><br>    Win32_POTSModemToSerialPort, <span class="hljs-comment">// MODEM 端口</span><br>    Win32_DesktopMonitor, <span class="hljs-comment">// 显示器</span><br>    Win32_DisplayConfiguration, <span class="hljs-comment">// 显卡</span><br>    Win32_DisplayControllerConfiguration, <span class="hljs-comment">// 显卡设置</span><br>    Win32_VideoController, <span class="hljs-comment">// 显卡细节。</span><br>    Win32_VideoSettings, <span class="hljs-comment">// 显卡支持的显示模式。</span><br><br>    <span class="hljs-comment">// 操作系统</span><br>    Win32_TimeZone, <span class="hljs-comment">// 时区</span><br>    Win32_SystemDriver, <span class="hljs-comment">// 驱动程序</span><br>    Win32_DiskPartition, <span class="hljs-comment">// 磁盘分区</span><br>    Win32_LogicalDisk, <span class="hljs-comment">// 逻辑磁盘</span><br>    Win32_LogicalDiskToPartition, <span class="hljs-comment">// 逻辑磁盘所在分区及始末位置。</span><br>    Win32_LogicalMemoryConfiguration, <span class="hljs-comment">// 逻辑内存配置</span><br>    Win32_PageFile, <span class="hljs-comment">// 系统页文件信息</span><br>    Win32_PageFileSetting, <span class="hljs-comment">// 页文件设置</span><br>    Win32_BootConfiguration, <span class="hljs-comment">// 系统启动配置</span><br>    Win32_ComputerSystem, <span class="hljs-comment">// 计算机信息简要</span><br>    Win32_OperatingSystem, <span class="hljs-comment">// 操作系统信息</span><br>    Win32_StartupCommand, <span class="hljs-comment">// 系统自动启动程序</span><br>    Win32_Service, <span class="hljs-comment">// 系统安装的服务</span><br>    Win32_Group, <span class="hljs-comment">// 系统管理组</span><br>    Win32_GroupUser, <span class="hljs-comment">// 系统组帐号</span><br>    Win32_UserAccount, <span class="hljs-comment">// 用户帐号</span><br>    Win32_Process, <span class="hljs-comment">// 系统进程</span><br>    Win32_Thread, <span class="hljs-comment">// 系统线程</span><br>    Win32_Share, <span class="hljs-comment">// 共享</span><br>    Win32_NetworkClient, <span class="hljs-comment">// 已安装的网络客户端</span><br>    Win32_NetworkProtocol, <span class="hljs-comment">// 已安装的网络协议</span><br>    Win32_PnPEntity,<span class="hljs-comment">//all device</span><br>&#125;<br></code></pre></td></tr></table></figure><p></p><h1 id="WMI读取硬件信息"><a href="#WMI读取硬件信息" class="headerlink" title="WMI读取硬件信息"></a>WMI读取硬件信息</h1><p>然后定义WMI读取硬件信息的函数，传入上面枚举的Win32 API和属性名作为参数，返回读取到的设备信息列表（string数组）<br></p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span><br><span class="hljs-comment"><span class="hljs-doctag">///</span> WMI读取硬件信息</span><br><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span><br><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="hardType"&gt;</span>硬件类型<span class="hljs-doctag">&lt;/param&gt;</span></span><br><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="propKey"&gt;</span>属性名<span class="hljs-doctag">&lt;/param&gt;</span></span><br><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>设备信息列表<span class="hljs-doctag">&lt;/returns&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span>[] <span class="hljs-title">MulGetHardwareInfo</span>(<span class="hljs-params">HardwareEnum hardType, <span class="hljs-keyword">string</span> propKey</span>)<br></span>&#123;<br><br>    List&lt;<span class="hljs-keyword">string</span>&gt; deviceList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();<br>    <span class="hljs-keyword">try</span><br>    &#123;<br>        <span class="hljs-keyword">using</span> (ManagementObjectSearcher searcher = <span class="hljs-keyword">new</span> ManagementObjectSearcher(<span class="hljs-string">"select * from "</span> + hardType))<br>        &#123;<br>            <span class="hljs-keyword">var</span> hardInfos = searcher.Get();<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> hardInfo <span class="hljs-keyword">in</span> hardInfos)<br>            &#123;<br>                deviceList.Add(hardInfo.Properties[propKey].Value.ToString());<br>            &#125;<br><br>            searcher.Dispose();<br>        &#125;<br>        <span class="hljs-keyword">return</span> deviceList.ToArray();<br>    &#125;<br>    <span class="hljs-keyword">catch</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-keyword">finally</span><br>    &#123; deviceList = <span class="hljs-literal">null</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p></p><h1 id="读取串口设备列表"><a href="#读取串口设备列表" class="headerlink" title="读取串口设备列表"></a>读取串口设备列表</h1><p>接着调用上面的函数，传入<code>Win32_SerialPort</code>接口和<code>Name</code>属性名，即可得到带设备名的串口列表。<br></p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">string</span>[] deviceList = MulGetHardwareInfo(HardwareEnum.Win32_SerialPort, <span class="hljs-string">"Name"</span>);<br></code></pre></td></tr></table></figure><p></p><p>得到的形式类似：</p><ol><li>Arduino Uno (COM3)</li><li>蓝牙链接上的标准串行 (COM4)</li><li>蓝牙链接上的标准串行 (COM5)</li></ol></article><div class="end"><span>The End</span></div><div class="copyright-announce"><p>© 本文著作权归 <a target="_blank" rel="external nofollow" href="https://github.com/vimcaw">vimcaw</a> 所有，未经许可，不得转载使用。</p></div><div id="comment"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNDA4MS8xMDYxOQ=="><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></div></div><div id="nav" class="iconfont icon-menu circle-button"></div><div class="shade"></div><a href="#top" data-scroll id="back-to-top" class="iconfont icon-top circle-button"></a><div id="image-view" class="hidden"><img src="" alt=""></div></div><footer><ul class="social"><li><a href="https://github.com/vimcaw" title="GitHub账号：https://github.com/vimcaw" class="iconfont icon-githublogo"></a></li><li><a href="mailto:vimcaw@gmail.com" title="Email: vimcaw@gmail.com" class="iconfont icon-icon-email"></a></li><li><a href="https://www.zhihu.com/people/zhu-chang-sheng-87/" title="知乎账号: https://www.zhihu.com/people/zhu-chang-sheng-87/" class="iconfont icon-zhihu0"></a></li></ul><div class="copyright"><p>Copyright © <span id="current-year">current</span> <a href="https://github.com/vimcaw"><span>vimcaw</span></a></p></div><div class="powered-by"><p>Powered by <a href="https://hexo.io/">Hexo</a></p></div><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv">本站总访问量 <span id="busuanzi_value_site_pv">-</span> 次</span></footer><script>document.getElementById("current-year").innerText=(new Date).getFullYear()</script><script src="/blog/js/post-c1a9f77be645ab72d87ed475fbc35091.js"></script><script src="https://unpkg.com/tippy.js@2.2.3/dist/tippy.all.min.js"></script><script>tippy(".date",{arrow:!0,size:"small"})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("{{theme.leancloud_visitors.app_id}}","{{theme.leancloud_visitors.app_key}}")</script><script>function $(e){return document.querySelector(e)}function $$(e){return document.querySelectorAll(e)}function showTime(e){var t=new AV.Query(e);$$(".leancloud_visitors").forEach(function(e){var n=e.id.trim();t.equalTo("url",n),t.find({success:function(e){if(0!=e.length)for(var t=0;t<e.length;t++){var o=e[t];r=document.getElementById(n).innerText+": "+o.get("time"),document.getElementById(n).innerText=r}else{var r=document.getElementById(n).innerText+": 0";document.getElementById(n).innerText=r}},error:function(e,t){console.log("Error: "+t.code+" "+t.message)}})})}function addCount(e){e=AV.Object.extend("Counter"),url=$(".leancloud_visitors").id.trim(),title=$(".leancloud_visitors").dataset.flagTitle.trim();var t=new AV.Query(e);t.equalTo("url",url),t.find({success:function(t){if(t.length>0){var n=t[0];n.fetchWhenSave(!0),n.increment("time"),n.save(null,{success:function(e){var t=document.getElementById(url).innerText+": "+e.get("time");document.getElementById(url).innerText=t},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var o=new e;o.set("title",title),o.set("url",url),o.set("time",1),o.save(null,{success:function(e){console.log("newcounter.get('time')="+e.get("time"));var t=document.getElementById(url).innerText+": "+e.get("time");document.getElementById(url).innerText=t},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}!function(){var e=AV.Object.extend("Counter");1==$$(".leancloud_visitors").length?addCount(e):$$(".post-title-link").length>1&&showTime(e)}(),HTMLCollection.prototype.forEach=function(e){for(var t,n=0;(t=this[n++])&&!1!==e(t););}</script><script>!function(t){var e=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function n(t,e){var n=new Image,i=t.getAttribute("data-original");n.onload=function(){t.src=i,e&&e()},n.src=i}function i(){for(var i=0;i<e.length;i++)(o=e[i].getBoundingClientRect()).top>=0&&o.left>=0&&o.top<=(t.innerHeight||document.documentElement.clientHeight)&&n(e[i],function(){e.splice(i,i)});var o}i(),t.addEventListener("scroll",i)}(this)</script></body></html>